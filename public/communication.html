<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Communication Hub - St. Andrews Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            grid-template-rows: auto 1fr;
            gap: 20px;
            height: 100vh;
        }

        .header {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.2);
        }

        .contact-item, .group-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            position: relative;
        }

        .contact-item:hover, .group-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(5px);
        }

        .contact-item.active, .group-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 12px;
            font-size: 0.9rem;
        }

        .contact-info h4 {
            font-size: 0.95rem;
            margin-bottom: 2px;
        }

        .contact-info p {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .status-indicator {
            position: absolute;
            right: 10px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #27ae60;
        }

        .status-indicator.away { background: #f39c12; }
        .status-indicator.busy { background: #e74c3c; }
        .status-indicator.offline { background: #95a5a6; }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-title h3 {
            font-size: 1.2rem;
        }

        .chat-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            display: flex;
            margin-bottom: 20px;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sent {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .message.sent .message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .message-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .message-sender {
            font-weight: 600;
            font-size: 0.85rem;
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .message-text {
            line-height: 1.5;
        }

        .attachment {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.05);
            padding: 10px;
            border-radius: 8px;
            margin-top: 8px;
            cursor: pointer;
        }

        .message.sent .attachment {
            background: rgba(255, 255, 255, 0.2);
        }

        .message-input-container {
            padding: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            background: white;
        }

        .message-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 0.9rem;
            resize: none;
            min-height: 20px;
            max-height: 100px;
            transition: border-color 0.3s ease;
        }

        .message-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-actions {
            display: flex;
            gap: 5px;
        }

        .attachment-btn, .send-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .attachment-btn {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .send-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .attachment-btn:hover, .send-btn:hover {
            transform: scale(1.1);
        }

        .right-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow-y: auto;
        }

        .panel-section {
            margin-bottom: 25px;
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .announcement {
            background: rgba(102, 126, 234, 0.05);
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .announcement-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .announcement-meta {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 8px;
        }

        .announcement-text {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .notification-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            background: rgba(102, 126, 234, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .notification-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(5px);
        }

        .notification-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 10px;
            font-size: 0.8rem;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .notification-time {
            font-size: 0.75rem;
            color: #7f8c8d;
        }

        .compose-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            padding: 5px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 250px 1fr 300px;
            }
        }

        @media (max-width: 968px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr;
                height: auto;
                min-height: 100vh;
            }

            .sidebar, .right-panel {
                display: none;
            }

            .sidebar.active, .right-panel.active {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                right: 20px;
                bottom: 20px;
                z-index: 100;
            }
        }

        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 200;
        }

        @media (max-width: 968px) {
            .mobile-nav {
                display: flex;
                gap: 10px;
            }
        }

        .typing-indicator {
            display: none;
            align-items: center;
            padding: 10px 15px;
            color: #7f8c8d;
            font-size: 0.85rem;
            font-style: italic;
        }

        .typing-dots {
            display: inline-flex;
            gap: 3px;
            margin-left: 5px;
        }

        .typing-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #7f8c8d;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üí¨ Communication Hub</h1>
            <p>St. Andrews Management System - Connect, collaborate, and communicate</p>
            <div class="header-controls">
                <button class="btn btn-primary" onclick="openComposeModal()">
                    ‚úâÔ∏è New Message
                </button>
                <button class="btn btn-secondary" onclick="openBroadcastModal()">
                    üì¢ Broadcast
                </button>
                <button class="btn btn-secondary" onclick="toggleNotifications()">
                    üîî Notifications
                </button>
            </div>
        </div>

        <!-- Left Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Recent Conversations</div>
                <div class="contact-item active" onclick="selectConversation('john-smith')">
                    <div class="avatar">JS</div>
                    <div class="contact-info">
                        <h4>John Smith</h4>
                        <p>Academic Advisor</p>
                    </div>
                    <div class="status-indicator"></div>
                </div>
                <div class="contact-item" onclick="selectConversation('sarah-johnson')">
                    <div class="avatar">SJ</div>
                    <div class="contact-info">
                        <h4>Sarah Johnson</h4>
                        <p>Finance Department</p>
                    </div>
                    <div class="status-indicator away"></div>
                </div>
                <div class="contact-item" onclick="selectConversation('mike-davis')">
                    <div class="avatar">MD</div>
                    <div class="contact-info">
                        <h4>Mike Davis</h4>
                        <p>IT Support</p>
                    </div>
                    <div class="status-indicator busy"></div>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Groups & Channels</div>
                <div class="group-item" onclick="selectConversation('faculty-meeting')">
                    <div class="avatar">FM</div>
                    <div class="contact-info">
                        <h4>Faculty Meeting</h4>
                        <p>25 members</p>
                    </div>
                </div>
                <div class="group-item" onclick="selectConversation('student-support')">
                    <div class="avatar">SS</div>
                    <div class="contact-info">
                        <h4>Student Support</h4>
                        <p>12 members</p>
                    </div>
                </div>
                <div class="group-item" onclick="selectConversation('admin-updates')">
                    <div class="avatar">AU</div>
                    <div class="contact-info">
                        <h4>Admin Updates</h4>
                        <p>8 members</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="main-content">
            <div class="chat-header">
                <div class="chat-title">
                    <div class="avatar">JS</div>
                    <div>
                        <h3 id="chatTitle">John Smith</h3>
                        <p id="chatStatus">Academic Advisor ‚Ä¢ Online</p>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="action-btn" onclick="startVideoCall()">üìπ Video</button>
                    <button class="action-btn" onclick="startVoiceCall()">üìû Call</button>
                    <button class="action-btn" onclick="shareScreen()">üì± Share</button>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <!-- Sample messages -->
                <div class="message">
                    <div class="message-content">
                        <div class="message-info">
                            <span class="message-sender">John Smith</span>
                            <span class="message-time">Today, 2:30 PM</span>
                        </div>
                        <div class="message-text">
                            Hello! I wanted to discuss the upcoming course registration deadline with you. We need to ensure all students are aware of the new procedures.
                        </div>
                    </div>
                </div>

                <div class="message sent">
                    <div class="message-content">
                        <div class="message-info">
                            <span class="message-sender">You</span>
                            <span class="message-time">Today, 2:32 PM</span>
                        </div>
                        <div class="message-text">
                            Absolutely! I've prepared a comprehensive guide for students. Would you like me to share it with you for review?
                        </div>
                    </div>
                </div>

                <div class="message">
                    <div class="message-content">
                        <div class="message-info">
                            <span class="message-sender">John Smith</span>
                            <span class="message-time">Today, 2:35 PM</span>
                        </div>
                        <div class="message-text">
                            That would be perfect! Please share the document.
                        </div>
                        <div class="attachment">
                            <span>üìé</span>
                            <span>Course_Registration_Guide.pdf</span>
                            <span>(2.3 MB)</span>
                        </div>
                    </div>
                </div>

                <div class="typing-indicator" id="typingIndicator">
                    <span>John Smith is typing</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>

            <div class="message-input-container">
                <div class="message-input-wrapper">
                    <textarea class="message-input" id="messageInput" placeholder="Type your message..." rows="1"></textarea>
                    <div class="input-actions">
                        <button class="attachment-btn" onclick="attachFile()">üìé</button>
                        <button class="send-btn" onclick="sendMessage()">‚û§</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel" id="rightPanel">
            <div class="panel-section">
                <div class="panel-title">
                    üì¢ Announcements
                </div>
                <div class="announcement">
                    <div class="announcement-title">System Maintenance</div>
                    <div class="announcement-meta">June 15, 2024 ‚Ä¢ IT Department</div>
                    <div class="announcement-text">
                        Scheduled maintenance on Sunday, June 16th from 2:00 AM to 6:00 AM. Some services may be temporarily unavailable.
                    </div>
                </div>
                <div class="announcement">
                    <div class="announcement-title">New Policy Update</div>
                    <div class="announcement-meta">June 14, 2024 ‚Ä¢ Administration</div>
                    <div class="announcement-text">
                        Updated student attendance policy is now in effect. Please review the new guidelines in the handbook.
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <div class="panel-title">
                    üîî Recent Notifications
                </div>
                <div class="notification-item">
                    <div class="notification-icon">üìù</div>
                    <div class="notification-content">
                        <div class="notification-title">New assignment submitted</div>
                        <div class="notification-time">5 minutes ago</div>
                    </div>
                </div>
                <div class="notification-item">
                    <div class="notification-icon">üë•</div>
                    <div class="notification-content">
                        <div class="notification-title">Meeting reminder</div>
                        <div class="notification-time">15 minutes ago</div>
                    </div>
                </div>
                <div class="notification-item">
                    <div class="notification-icon">üìä</div>
                    <div class="notification-content">
                        <div class="notification-title">Report generated</div>
                        <div class="notification-time">1 hour ago</div>
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <div class="panel-title">
                    üë• Online Users
                </div>
                <div class="contact-item">
                    <div class="avatar">AM</div>
                    <div class="contact-info">
                        <h4>Alice Miller</h4>
                        <p>Student Affairs</p>
                    </div>
                    <div class="status-indicator"></div>
                </div>
                <div class="contact-item">
                    <div class="avatar">RT</div>
                    <div class="contact-info">
                        <h4>Robert Taylor</h4>
                        <p>Registrar</p>
                    </div>
                    <div class="status-indicator"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav">
        <button class="btn btn-primary" onclick="toggleSidebar()">üí¨</button>
        <button class="btn btn-primary" onclick="toggleRightPanel()">üîî</button>
    </div>

    <!-- Compose Message Modal -->
    <div class="compose-modal" id="composeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Compose New Message</h3>
                <button class="close-btn" onclick="closeComposeModal()">&times;</button>
            </div>
            <form id="composeForm">
                <div class="form-group">
                    <label class="form-label">To:</label>
                    <select class="form-select" id="recipientSelect">
                        <option value="">Select recipient...</option>
                        <option value="john-smith">John Smith - Academic Advisor</option>
                        <option value="sarah-johnson">Sarah Johnson - Finance</option>
                        <option value="mike-davis">Mike Davis - IT Support</option>
                        <option value="faculty-meeting">Faculty Meeting Group</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Subject:</label>
                    <input type="text" class="form-input" id="subjectInput" placeholder="Enter subject...">
                </div>
                <div class="form-group">
                    <label class="form-label">Message:</label>
                    <textarea class="form-textarea" id="messageTextarea" placeholder="Type your message..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Priority:</label>
                    <select class="form-select" id="prioritySelect">
                        <option value="normal">Normal</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                    </select>
                </div>
                <div class="header-controls">
                    <button type="button" class="btn btn-secondary" onclick="closeComposeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Send Message</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sample conversation data
        const conversations = {
            'john-smith': {
                name: 'John Smith',
                title: 'Academic Advisor',
                status: 'Online',
                messages: [
                    { sender: 'John Smith', time: 'Today, 2:30 PM', text: 'Hello! I wanted to discuss the upcoming course registration deadline with you.' },
                    { sender: 'You', time: 'Yesterday, 4:30 PM', text: 'I\'ll review it by tomorrow morning and send you my feedback.' }
                ]
            },
            'mike-davis': {
                name: 'Mike Davis',
                title: 'IT Support',
                status: 'Busy',
                messages: [
                    { sender: 'Mike Davis', time: 'Today, 10:00 AM', text: 'The server maintenance is scheduled for this weekend.' },
                    { sender: 'You', time: 'Today, 10:05 AM', text: 'Thanks for the heads up. Should we notify all users?' }
                ]
            },
            'faculty-meeting': {
                name: 'Faculty Meeting',
                title: '25 members',
                status: 'Group Chat',
                messages: [
                    { sender: 'Dr. Williams', time: 'Today, 9:00 AM', text: 'Reminder: Faculty meeting tomorrow at 3 PM in Conference Room A.' },
                    { sender: 'Prof. Anderson', time: 'Today, 9:15 AM', text: 'Will the agenda be sent out beforehand?' },
                    { sender: 'You', time: 'Today, 9:20 AM', text: 'I\'ll prepare and distribute the agenda by end of day.' }
                ]
            }
        };

        let currentConversation = 'john-smith';
        let typingTimeout;

        // Initialize the chat
        function initializeChat() {
            loadConversation(currentConversation);
            autoResizeTextarea();
            setupKeyboardShortcuts();
        }

        // Load conversation messages
        function loadConversation(conversationId) {
            const conversation = conversations[conversationId];
            if (!conversation) return;

            currentConversation = conversationId;

            // Update chat header
            document.getElementById('chatTitle').textContent = conversation.name;
            document.getElementById('chatStatus').textContent = `${conversation.title} ‚Ä¢ ${conversation.status}`;

            // Clear and load messages
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';

            conversation.messages.forEach(message => {
                addMessageToChat(message.sender, message.text, message.time, message.sender === 'You');
            });

            // Add typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing-indicator';
            typingIndicator.id = 'typingIndicator';
            typingIndicator.innerHTML = `
                <span>${conversation.name} is typing</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            container.appendChild(typingIndicator);

            container.scrollTop = container.scrollHeight;
        }

        // Add message to chat
        function addMessageToChat(sender, text, time, isSent = false) {
            const container = document.getElementById('messagesContainer');
            const typingIndicator = document.getElementById('typingIndicator');

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isSent ? 'sent' : ''}`;

            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-info">
                        <span class="message-sender">${sender}</span>
                        <span class="message-time">${time}</span>
                    </div>
                    <div class="message-text">${text}</div>
                </div>
            `;

            if (typingIndicator) {
                container.insertBefore(messageDiv, typingIndicator);
            } else {
                container.appendChild(messageDiv);
            }

            container.scrollTop = container.scrollHeight;
        }

        // Select conversation
        function selectConversation(conversationId) {
            // Update active state in sidebar
            document.querySelectorAll('.contact-item, .group-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.contact-item, .group-item').classList.add('active');

            loadConversation(conversationId);
        }

        // Send message
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();

            if (text === '') return;

            const now = new Date();
            const timeString = `Today, ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')} ${now.getHours() >= 12 ? 'PM' : 'AM'}`;

            addMessageToChat('You', text, timeString, true);
            input.value = '';
            input.style.height = 'auto';

            // Add to conversation data
            if (conversations[currentConversation]) {
                conversations[currentConversation].messages.push({
                    sender: 'You',
                    time: timeString,
                    text: text
                });
            }

            // Simulate typing indicator and response
            showTypingIndicator();
            setTimeout(() => {
                hideTypingIndicator();
                simulateResponse();
            }, 2000);
        }

        // Show typing indicator
        function showTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.style.display = 'flex';
            }
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.style.display = 'none';
            }
        }

        // Simulate response
        function simulateResponse() {
            const responses = [
                "Thanks for your message! I'll get back to you shortly.",
                "That sounds good. Let me check on that for you.",
                "I appreciate the update. I'll review this and respond soon.",
                "Perfect! I'll take care of that right away.",
                "Got it! I'll coordinate with the team and let you know."
            ];

            const response = responses[Math.floor(Math.random() * responses.length)];
            const conversation = conversations[currentConversation];
            const time = `Today, ${new Date().getHours()}:${new Date().getMinutes().toString().padStart(2, '0')} ${new Date().getHours() >= 12 ? 'PM' : 'AM'}`;

            addMessageToChat(conversation.name, response, time, false);

            // Add to conversation data
            conversation.messages.push({
                sender: conversation.name,
                time: time,
                text: response
            });
        }

        // Auto-resize textarea
        function autoResizeTextarea() {
            const textarea = document.getElementById('messageInput');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 100) + 'px';
            });

            // Send message on Enter, new line on Shift+Enter
            textarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        }

        // Setup keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'n':
                            e.preventDefault();
                            openComposeModal();
                            break;
                        case 'f':
                            e.preventDefault();
                            document.getElementById('messageInput').focus();
                            break;
                    }
                }
            });
        }

        // Modal functions
        function openComposeModal() {
            document.getElementById('composeModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeComposeModal() {
            document.getElementById('composeModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.getElementById('composeForm').reset();
        }

        function openBroadcastModal() {
            // Implement broadcast modal
            alert('Broadcast feature coming soon!');
        }

        // Handle compose form submission
        document.getElementById('composeForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const recipient = document.getElementById('recipientSelect').value;
            const subject = document.getElementById('subjectInput').value;
            const message = document.getElementById('messageTextarea').value;
            const priority = document.getElementById('prioritySelect').value;

            if (!recipient || !subject || !message) {
                alert('Please fill in all required fields.');
                return;
            }

            // Here you would typically send the message to your backend
            console.log('Sending message:', { recipient, subject, message, priority });

            alert('Message sent successfully!');
            closeComposeModal();
        });

        // Attachment function
        function attachFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = '.pdf,.doc,.docx,.txt,.jpg,.png,.gif';

            input.onchange = function(e) {
                const files = Array.from(e.target.files);
                files.forEach(file => {
                    const time = `Today, ${new Date().getHours()}:${new Date().getMinutes().toString().padStart(2, '0')} ${new Date().getHours() >= 12 ? 'PM' : 'AM'}`;
                    const messageHtml = `
                        <div class="message sent">
                            <div class="message-content">
                                <div class="message-info">
                                    <span class="message-sender">You</span>
                                    <span class="message-time">${time}</span>
                                </div>
                                <div class="message-text">Shared a file:</div>
                                <div class="attachment">
                                    <span>üìé</span>
                                    <span>${file.name}</span>
                                    <span>(${(file.size / 1024 / 1024).toFixed(1)} MB)</span>
                                </div>
                            </div>
                        </div>
                    `;

                    const container = document.getElementById('messagesContainer');
                    const typingIndicator = document.getElementById('typingIndicator');

                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = messageHtml;

                    if (typingIndicator) {
                        container.insertBefore(tempDiv.firstElementChild, typingIndicator);
                    } else {
                        container.appendChild(tempDiv.firstElementChild);
                    }

                    container.scrollTop = container.scrollHeight;
                });
            };

            input.click();
        }

        // Communication functions
        function startVideoCall() {
            const conversation = conversations[currentConversation];
            alert(`Starting video call with ${conversation.name}...`);
        }

        function startVoiceCall() {
            const conversation = conversations[currentConversation];
            alert(`Starting voice call with ${conversation.name}...`);
        }

        function shareScreen() {
            alert('Screen sharing feature coming soon!');
        }

        function toggleNotifications() {
            const rightPanel = document.getElementById('rightPanel');
            rightPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // Mobile functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        function toggleRightPanel() {
            const rightPanel = document.getElementById('rightPanel');
            rightPanel.classList.toggle('active');
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('composeModal');
            if (event.target === modal) {
                closeComposeModal();
            }
        };

        // Real-time features simulation
        function simulateRealTimeUpdates() {
            // Simulate new notifications
            setInterval(() => {
                const notifications = [
                    { icon: 'üìß', title: 'New message received', time: 'Just now' },
                    { icon: 'üìÖ', title: 'Meeting starting soon', time: '2 minutes ago' },
                    { icon: '‚úÖ', title: 'Task completed', time: '5 minutes ago' }
                ];

                // Add random notification (simplified for demo)
                console.log('New notification:', notifications[Math.floor(Math.random() * notifications.length)]);
            }, 30000);

            // Simulate typing indicators
            setInterval(() => {
                if (Math.random() > 0.8) {
                    showTypingIndicator();
                    setTimeout(hideTypingIndicator, 3000);
                }
            }, 15000);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeChat();
            simulateRealTimeUpdates();

            // Set focus to message input
            document.getElementById('messageInput').focus();
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            const container = document.getElementById('messagesContainer');
            container.scrollTop = container.scrollHeight;
        });
    </script>
</body>
</html>'Today, 2:32 PM', text: 'Absolutely! I\'ve prepared a comprehensive guide for students.' },
                    { sender: 'John Smith', time: 'Today, 2:35 PM', text: 'That would be perfect! Please share the document.' }
                ]
            },
            'sarah-johnson': {
                name: 'Sarah Johnson',
                title: 'Finance Department',
                status: 'Away',
                messages: [
                    { sender: 'Sarah Johnson', time: 'Yesterday, 4:15 PM', text: 'Can you review the budget proposal for next semester?' },
                    { sender: 'You', time: